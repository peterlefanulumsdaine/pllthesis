\documentclass{amsart}

\usepackage{color}
\usepackage{ifpdf}
\usepackage{mathpartir}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{amsmath}
\usepackage[all]{xypic}
\usepackage{wrapfig}

\xyoption{2cell}
\xyoption{rotate}
%\xyoption{curve}
\UseTwocells
\input{diagxy}

% \usepackage{makeindex}

\include{thesis-style}
\include{thesis-macros}

\newcommand{\CompCat}{\mathbf{CompCat}}

\newcommand{\arr}{\mathrm{arr}}
\newcommand{\ext}{\mathrm{ext}}
% \newcommand{\Jbar}{\overline{J}}
\newcommand{\tree}{\mathrm{tree}}
\newcommand{\tr}{\mathrm{tr}}
\newcommand{\stuff}{{\Phi}}
% \makeindex

%%
%% PDFJUNK
%% Can add /CreationDate, /Creator, /Subject, /Keywords
%%
\ifpdf
\pdfinfo{
  /Author (Peter LeFanu Lumsdaine) 
  /Title (TODO: put thesis title here when decided!)
}
\fi
%%
%% BEGIN DOCUMENT:
%\onehalfspacing
\begin{document}



%% TITLE INFORMATION

\title{The classifying weak $\omega$-category of a type theory}

\author[P. LeF. Lumsdaine]{Peter LeFanu Lumsdaine}

\maketitle
\tableofcontents

\section*{General notes on these notes}

Note on treatment of fibrations: all fibrations of categories are assumed cloven, but considered just as fibrations ($\Fib$), maps between them need not preserve the cleavings, whereas maps of cloven fibrations ($\ClovFib$) do.


\section{Type-theoretic background}

\comment{To include: give basic type theory syntactically---first the structural core, then constructors and various extensionality axioms.  Then give categorical equivalent; crucially, set $\DTT$ up as ess.\ alg.\ and show that extra rules/constructors are ess.\ alg.\ extensions.  Discuss the various constructions: dependent contexts, slicing, co-slicing.  Finally, discuss normalisation/canonicity!}

\subsection{Syntactic presentation}

\begin{para}Several different, mostly equivalent, syntactic presentations of Martin-LÃ¶f-style dependent type theory exist in the literature; the present one is essentially based (up to notation) on those of \cite{pitts:categorial-logic} and \cite{hofmann:syntax-and-semantics}.

A word about the range of theories we will consider is, however, in order here.  All theories we consider will share the common basic syntax and structural core presented in \ref{para:basic-syntax} and \ref{para:structural-core}.  We will, however, vary the constructors we add on top of that, in two stages.  Firstly, by a \emph{type system} we will mean the extension of this structural core by some selection $\stuff$ of the constructors and rules of \ref{para:constructors} and \ref{para:rules}, and of other standard constructors and rules, within certain limitations---a precise statement will appear in \ref{para:types-systems-as-ess-alg}.  Secondly, over a given such system $\stuff$, we will consider arbitrary extensions by \emph{algebraic} axioms, organised into a category $\DTT_\stuff$ of \emph{theories over $\stuff$}.
\end{para}

\begin{para}[Basic syntax]
Since we will eventually work in a presentation-agnostic category of type theories, the precise formalism we use for the raw syntax will not be of importance; but for the sake of definiteness, let us suppose a simply-typed metalanguage in which the syntax of our theory is formalised, as described in e.g.\ \cite[6.1]{pitts:categorial-logic}, and in which we have defined notions of free variables, capture-avoiding substitution, etc.

The basic judgements of our theory are now minimal---\emph{types}, \emph{terms}, and \emph{definitional equalities} between each of these:
\end{para}
\begin{center}\begin{tabular}{@{\ }c@{\hskip 0.75in}c@{\ }}
$\Gamma \types A \ \type $ & $ \Gamma \types a:A $ \\ \rule{0pt}{3ex} 
$\Gamma \types A = A' \ \type $& $ \Gamma \types a = a' : A $ \\
\end{tabular}
\end{center}

On top of these, we work with derived judgements of \emph{contexts} and \emph{context morphisms}\footnote{also sometimes known as \emph{subtitutions} or \emph{telescopes}} between them:
\begin{center}\begin{tabular}{@{\ }c@{\hskip 0.75in}c@{\ }}
$\types \Gamma \ \cxt$ & $ \types  f : \Gamma \To \Gamma' $  \\ \rule{0pt}{3ex} 
$\types \Gamma = \Gamma' \ \cxt$ &  $\types { f} = { f}' : \Gamma \To \Gamma'$ \\
\end{tabular}
\end{center}

(In all these judgements, we put the obvious restrictions on the free variables of the objects involved.)

In the sequel, we will sometimes also use dependent versions of these derived judgements, though they will not be needed in the presentation of the theory:
\begin{center}\begin{tabular}{@{\ }c@{\hskip 0.75in}c@{\ }}
$ \Gamma \types \Delta \ \cxt$ & $\Gamma \types { f} : \Delta \To \Delta' $  \\ \rule{0pt}{3ex} 
$ \Gamma \types \Delta = \Delta' \ \cxt$ & $\Gamma \types { f} = { f}' : \Delta \To \Delta'$ \\
\end{tabular}
\end{center}

In slight abuse of notation, we will often explicitly display free variables for emphasis or readability, writing e.g.\ $\x : \Gamma \types A(\x)\ \type$ interchangeably with $\Gamma \types A\ \type$.

\begin{para}[Structural core] Rules for contexts:
$$\begin{array}{c}
\inferrule*[right=$\cxt$-$\empt$]{ \ }{ \quad \types \diamond \ \cxt \quad } \qquad \inferrule*[right={$\cxt$=-$\empt$}]{\ }{ \quad \types \diamond = \diamond \ \cxt \quad }
\\ \ \\
\inferrule*[right=$\cxt$-$\cons$]{\types \Gamma\ \cxt \\\\ \Gamma \types A \ \type}{ \quad \types \Gamma, y:A\ \cxt \quad } \qquad
\inferrule*[right={$\cxt$=-$\cons$}]{ \types \Gamma = \Gamma'\ \cxt \\\\ \Gamma \types A = A'[ \x / \x' ]\ \type}{ \quad \types \Gamma, y:A = \Gamma', y':A'\ \cxt \quad } 
\end{array}
$$

Rules for types: 

$$\begin{array}{c}
\inferrule*[right={$\type$=-$\refl$}]{\Gamma \types A\ \type}{\quad \Gamma \types A = A\ \type \quad} \qquad
\inferrule*[right={$\type$=-$\sym$}]{\Gamma \types A = B\ \type}{\quad \Gamma \types B = A\ \type \quad} \\ \ \\
\inferrule*[right={$\type$=-$\trans$}]{\Gamma \types A = B\ \type \\\\ \Gamma \types B = C\ \type}{\quad \Gamma \types A = C\ \type \quad} \qquad 
\inferrule*[right=$\type$-$\subst$]{\x : \Gamma \types A(\x)\ \type \\\\ \types f : \Gamma' \To \Gamma}{\quad \Gamma' \types A[f/\x] \type \quad} \\ \ \\
\inferrule*[right={$\type$=-$\subst$}]{ \Gamma \types A = A'\ \type \\\\  \types f = f' : \Gamma' \To \Gamma}{\quad \Gamma' \types A[f/\x] = A'[f'/\x]\ \type\quad }
\end{array}$$


Rules for terms: 

$$\begin{array}{c}
\inferrule*[right={\sf var}]{\Gamma \types A\ \type \\ \Gamma, A \types \Delta\ \cxt}{\quad \Gamma, x:A, \Delta \types x : A \quad}
\qquad \qquad
\inferrule*[right={$\term$=-$\refl$}]{\Gamma \types a : A}{\quad \Gamma \types a = a : A\quad}
\\ \ \\
\inferrule*[right={$\term$=-$\sym$}]{\Gamma \types a = b : A}{\quad \Gamma \types b = a : A \quad}
\qquad \qquad 
\inferrule*[right={$\term$=-$\trans$}]{\Gamma \types a = b : A \\\\ \Gamma \types b = c : A}{\quad \Gamma \types a = c : A \quad} \qquad 
\\ \ \\
\inferrule*[right={\sf term-coerce}]{\Gamma \types a : A \\\\ \Gamma \types A = A'\ \type}{\quad \Gamma \types a : A' \quad} \qquad \quad
\inferrule*[right={\sf term=-coerce}]{\Gamma \types a = a' : A \\\\ \Gamma \types A = A'\ \type}{\quad \Gamma \types a = a' : A' \quad}
\\ \ \\
\inferrule*[right=$\term$-$\subst$]{ \Gamma \types a : A \\\\  \types f : \Gamma' \To \Gamma}{\ \Gamma' \types a[f/\x] : A[f/\x]\ } \qquad
\inferrule*[right={$\term$=-$\subst$}]{ \Gamma \types a = a' : A \\\\ \types f = f' : \Gamma' \To \Gamma}{\ \Gamma' \types a[f/\x] = a'[f'/\x] : A[f/\x]\ }
\end{array}$$

Rules for context maps: 

$$\begin{array}{c}
\inferrule*[right={$\cxtmap$-$\empt$}]{ \types \Gamma\ \cxt}{ \types \diamond : \Gamma \To \diamond} 
\qquad \qquad
\inferrule*[right={$\cxtmap$=-$\empt$}]{ \types \Gamma\ \cxt}{ \types \diamond = \diamond : \Gamma \To \diamond}
\\ \ \\
\inferrule*[right={$\cxtmap$-$\cons$}]{ \types f : \Gamma' \To \Gamma \\\\ \Gamma \types A\ \type \\\\ \Gamma' \types a : A[f/\x] }{\ \types f,a : \Gamma' \To \Gamma, y:A \ } \qquad
\inferrule*[right={$\cxtmap$=-$\cons$}]{ \types f = f' : \Gamma' \To \Gamma \\\\ \Gamma \types A\ \type \\\\ \Gamma' \types a = a' : A[f/\x] }{\ \Gamma \types (f,a) = (f',a') : \Delta' \To (\Delta, A) \ }
\end{array}$$

\end{para}

\begin{para}[Type constructors]
Yarp.
\end{para}

\begin{para}[Other optional rules]
Garp!
\end{para}

\begin{para}[Algebraic rules]
Zarp?
\end{para}

\begin{para}[Logical frameworks]
Barp\ldots
\end{para}

\subsection{Categorical representation}

\begin{definition}A \emph{category with families}: $\C$, $\Ty$, comprehension$\ldots$  Variations: with $\diamond$; with $1$, with nothing, accessible, contextual.
\end{definition}

\begin{proposition}[\cite{hofmann:syntax-and-semantics}, \cite{pitts:categorical-logic}] \label{prop:cwf-equivalence} Equivalence: small contextual CwF's are \emph{equivalent} to type theories presented by a small set of purely algebraic axioms (i.e.\ dependent terms and types, and equality axioms between them), via adjunction.  Hence: universal property of CwF's presented by axioms (need this precisely stated to allow us to use normalisation results below).
\end{proposition}

This equivalence justifies working with \emph{presentation-agnostic} category of type theories $\DTT$: we will construct and work with objects of $\DTT$ (\emph{theories}) sometimes as syntactic presentations, sometimes as categories with families.  Given any construction either on syntactically presented theories or on contextual CwF's, we'll transfer it without comment to $\DTT$, and so forth.  In subsequent sections, we will work almost(?) entirely in terms of $\DTT$, but for the constructions of this section it will be convenient to work in $\CwF_\cxl$, for the sake of its connections to other categories of CwF's.

\begin{para} We'll use a few pieces of obvious terminology for working in CwF's.  For an object $\Gamma \in \C$, a \emph{dependent context} over $\Gamma$ is a sequence $A_1 \in \Ty(\Gamma)$, $A_2 \in \Ty(\Gamma.A_1)$, \ldots $A_l \in \Ty(\Gamma.A_1.\ldots.A_{l-1})$, for some $l \geq 0$.  (Write $\Cxt(\Gamma)$ for the set of these.)

For a type $A \in \Ty(\Gamma)$, a \emph{term of type $A$ in context $\Gamma$} is a section $a : \Gamma \to \Gamma.A$ of the dependent projection $\Gamma.A \to \Gamma$.  (Write $\Tm_\Gamma(A)$ for the set of these.)
\end{para}

\subsection{Theories with constructors}

Of course, we want categories not just of \emph{algebraic} dependent type theories, but of type theories with \emph{constructors}; in particular, $\Id$- and $\Pi$-types.  These too can be succinctly and profitably defined in terms of CwF's.  In particular:

\begin{definition} An \emph{elim-structure} $J$ on a map $i : \Gamma \to \Theta$ is a function assigning, to every type $C \in \Ty(\Theta)$ and every term $d : \Gamma \to \Gamma.i^*C$ of type $i^*C$ (equivalently, every map $\hat{d} : \Gamma \to \Theta.C$ over $\Theta$) a term $J_{C,d} : \Theta \to \Theta.C$ of type $C$

An \emph{absolute (Frobenius?) elim-structure} on $i : \Gamma \to \Theta$ is an elim-structure $J_\Delta$ on $i.\Delta$ for each $\Delta \in \Cxt(\Theta)$.
\end{definition}

(Compare the last refinement described in Example \ref{ex:left-maps-from-right} above, with the basic dependent projections $\Theta.A \to \Theta$ as the generating $\R$-maps (see next subsection).)

This axiomatises the structure provided by the elimination/computation rules for an inductive type with just a single introduction form $i$.  (It can be nicely generalised to deal with multiple introduction forms, but we will not need that.) In particular:

\begin{definition}
A \emph{CwF with $\Id$-types} is a CwF $\C$, together with:
\begin{itemize}
\item for each context $\Gamma \in \C$ and type $A \in \Ty(\Gamma)$, a type $\Id_A \in \Ty(\Gamma.A.A)$, and a morphism $r_A : \Gamma.A \to \Gamma.A.A.\Id_A$ over $\Delta_A : \Gamma.A \to \Gamma.A.A$ with an absolute elim-structure $J_A$,
\item all stable in $\Gamma$, in that for $f:\Gamma' \to \Gamma$ and $A \in \Ty(\Gamma)$, we have $(f.A.A)^*\Id_A = \Id_{f^*A} \in \Ty(\Gamma'.f^*A.f^*A)$, and so on.
\end{itemize}
\end{definition}

Write $\CwF^\Id$, $\CwF_\diamond^\Id$, etc.\ for the various categories of CwF's with $\Id$-types.  

\begin{proposition}[\cite{hofmann:syntax-and-semantics}, \cite{pitts:categorical-logic}] This structure really does correspond precisely to the $\Id$-type rules: the equivalence of Proposition \ref{prop:cwf-equivalence} lifts to an equivalence between $\CwF^\Id_\cxl$ and a category of syntactically presented theories with $\Id$-type rules plus algebraic axioms. 
\end{proposition}

Also: define $\Pi$-types, $\eta$-rules, and extensional equality on them. 

\begin{para}{Left and right maps in a CwF} \label{subsec:left-right-in-cwf}
The above presentation of $\Id$-types via elim-structures is based on ideas of Gambino and Garner (\cite{gambino-garner}) which will be very useful to us: that any CwF has an important class of left and right maps, which in the presence of $\Id$-types is moreover a wfs.

The right maps are just (maps isomorphic to) (compositions of basic) dependent projections.  The left maps are maps admitting an (or algebraically: with a chosen) elim-structure; following observations above, this gives exactly $\L = {}^\pitchfork \R$.  

(\cite{gambino-garner} moreover gives an alternative type-theoretic characterisation of each class of maps, and uses $\Id$-types to construct $\L,\R$ factorisations, but we will not need these.)
\end{para}


\subsection{Constructions on DTT's/CwF's}

There are several interesting and important ways to construct new type theories from old:

\begin{para} First, the \emph{dependent contexts monad} on $\CwF$ over $\Cat$, sending $\C = (\C,\Ty)$ to $\C^\Cxt := (\C,\Cxt)$.  So types of the new theory are just dependent contexts in the old theory; the base category is unchanged, and context extension is just by concatenation.  This can be seen as the monad for ``very strong, strictly associative $\Sigma$-types''.)  

Moreover, given $\Id$-types structure on $\C$, we can extend this to an $\Id$-types structure on $\C^\Cxt$: this is the ``identity contexts'' of \cite{streicher:habilitationsthesis} or \cite{gambino-garner}.  \todo{[Give more specific citations, and/or present details?]}  So we have an endofunctor $(-)^\Cxt$ on $\CwF^\Id$. However, the monad structure does \emph{not} lift to $\CwF^\Id$: the multiplication turns out not to preserve $\Id$-contexts strictly.  (This could presumably be accommodated by developing a theory of pseudo-maps of $\CwF^\Id$'s.)

Similar considerations let us lift it to act as an endofunctor on CwF's with any of $\Sigma$-types, $\Pi$-types, the functional extensionality rules, and most other standard constructors.

Varying our CwF's along the other axis, ``contextuality'', for each set of constructors $(-)^\Cxt$ lifts to an endofunctor on $\CwF_\diamond$, but not on $\CwF_\cxl$: its result is almost never contextual, since adjoining two types $A$ and $B$ to a context in succesion has the same result as adjoining $(A,B)$ in one step, so (as long as the original theory had any types at all) there can be no well-defined notion of length.
\end{para}

\begin{para} The \emph{slice} construction is one of the fundamental tools of the category--type~theory correspondence; however, in terms of CwF's, it is not exactly the ordinary categorical slice.

For $\C$ any CwF, and $\Gamma$ any object of $\C$, the \emph{(type-theoretic) slice} $\C \slice \Gamma$ has as objects dependent contexts over $\Gamma$, and morphisms and families structure induced by pullback along the map $\ob (\C \slice \Gamma) \to \ob \C$ sending $\Delta \in \Cxt_\C(\Gamma)$ to $\Gamma,\Delta$.

Slices are always contextual; in particular, by slicing each $\C \in \CwF_\diamond$ over $\diamond$, we obtain a coreflection $\CwF_\diamond \to \CwF_\cxl$.

In syntactic terms, slicing corresponds to taking variables into the context: judgements $\Delta \types \J$ in $\T \slice \Gamma$ correspond exactly to judgements $\Gamma, \Delta \types \J$ in $\T$.
\end{para}

\begin{para} \label{par:types-to-cxts}Combining this with the dependent contexts construction gives us an endofunctor of $\CwF_\cxl$:
$$ \CwF_\cxl \mono<300> \CwF_\diamond \to^{(-)^\Cxt} \CwF_\diamond \to^{- \slice \diamond} \CwF_\cxl$$

An object of the resulting $\C^\Cxt \slice \diamond$ can be seen as an object $A_1,\ldots,A_k$ of $\C$ together with a partition $k = \sum_{i \leq l} k_i$, thought of as dividing the context into chunks: 
$$(A_1,\ldots,A_{k_1});\ (A_{k_1 + 1}, \ldots , A_{k_1 + k_2});\ \ldots ;\  (A_{\sum_{i < l}k_i + 1}, \ldots, A_k).$$
A ``type'' over such an object is then a dependent context over the full (un-chunked) context in $\C$; context extension adjoins the dependend context as a single additional chunk.  There is a natural inclusion $\C \mono \C^\Cxt \slice \diamond$, chunking each context into individual types.

This construction will be briefly but crucially useful to us, in Corollary \ref{cor:types-to-cxts}.
\end{para}

\begin{para} With some of our constructors, we can also construct \emph{co-slice theories}.  In a co-slice $\Theta \coslice \C$, an object is a map $g \colon \Theta \to \Gamma$ of $\C$ (a \emph{$\Theta$-pointed object of $\C$}); a map $(g,\Gamma) \to (d,\Delta)$ is a map $f \colon \Gamma \to \Delta$ of $\C$ with $fg = d$ (i.e.\ preserving the ``point''); and a type over $(g,\Gamma)$ is a type $A \in \Ty(\Gamma)$ together with a term $a$ of $g^*A$, or equivalently a point $(g,a) \colon \Theta \to \Gamma, A$ for which $\pi_{\Gamma;A} (g,a) = g$.  

There is an obvious projection $\Theta \coslice \C \to \C$, forgetting points.

This construction preserves contextuality; it also extends to act on $\Id$-types, $\Sigma$-types, $\One$, and more generally on inductive types with a single unary constructor; but it does \emph{not} act on $\Pi$-types, nor on $\Bool$, $\Zero$, or most other type-formers.  This is familiar categorically: co-slices retain e.g.\ binary products and terminal objects, but not coproducts or exponentials.
\end{para}

\begin{para}[Normalisation results]  It is a fundamental fact, going back to \cite{martin-lof:predicative-part}, that the basic structural theory together with any subset of the standard constructors ($\Id$-, $\Sigma$-, $\Pi$-types, and also $\Nat$ and $\Bool$) is strongly normalising.

Moreover, it is easy to see \todo{[but is it proven anywhere citable??]} that this result extends to theories including algebraic type- and term-forming axioms.  (It can fail, however, under the addition of algebraic definitional equality axioms.)  In particular, \ldots

\todo{[Problem: I can't figure out how to give a general result of the form I want: ``in some class of simple theories, all closed normal forms are canonical, and so any closed forms that are propositionally equal are definitionally so''.  However, I can't find a succinct description of a suitable class of theories.  I guess it's just OK to give normalisation here, and invoke ththe further result when I use it?  But I'd like to be able to refer to this result specifically\ldots  Hm.]}

It is currently somewhat unclear to what extent one can retain strong normalisation in conjunction with the functional extensionality rules.  The Observational Type Theory of Altenkirch and collaborators (\cite{altenkirch:ott}, \cite{altenkirch-mcbride-swierstra}) achieves this, but has \emph{defined} rather than axiomatic identity types (and therefore does not easily permit extension by further type axioms), and moreover forces these to be trivial: any two terms of an identity type are equal (the UIP axiom of \cite{hofmann:extensional??}).  However, the OTT system is an encouraging step towards the development of a fully intensional system with functional extensionality.  (The difficulty lies essentially in defining the computational behaviour of the extensionality combinator; this seems to be related to the difficulties of the principle $\Jbar$ of Section \ref{sec:jbar}.)
\end{para}






























\section{Globular structures from $\DTT$}

\comment{Recall from background: general construction of $\Spans[\C]$, operads therein.  Homming-out facts? or put those in main body?}

\comment{Give: the globes, and variants of globes; the Kan constructions; fact that pasting diagrams get realised by these; resulting functors $\DTT \to \Alg{\End(\globes)}$.]}

\subsection{Endomorphism operads; categories with fibrations: Background}
\label{subsec:endo-operads}

To open: Quickly recall (as in prev paper) strict $\omega$-categories.

To do here: Recall from \cite{batanin:natural-environment} Globular monoidal categories; operads.

In moving to the weak case, we wish to formalise the idea that our laws may hold only up to homotopy: there may be not just one way of composing a given pasting diagram, there may be several, although they will all be equal up to cells of the next dimension. 

This is formalised in the notion of a \emph{contractible globular operad}.  There are several equivalent presentations of this idea, as given in e.g. \cite{batanin:natural-environment}, \cite{leinster:book}, and \cite{weber:operads-within}.

The presentation of Leinster (\cite{leinster:book}) (which I used in \cite{lumsdaine:tlca}), via cartesian monads and generalised multicategories, is perhaps the most accessible approach, but is less general than the others.  Some constructions may be extremely elegantly presented in this setting, but others become rather difficult.

The original presentation of Batanin (\cite{batanin:natural-environment}), via monoidal globular categories in general and $\Spans$ in particular, is more elementary, but with this approach it can be difficult sometimes to see the wood for the trees; constructions in this setting are typically long but comparatively straightforward to verify.  

The presentation of Weber (in e.g. \cite{weber:operads-within}), via \emph{monoidal pseudo-algebras} is, essentially, an abstraction of Batanin's approach, on the one hand allowing more generality, and on the other hand giving a clearer picture of how the various elements of Batanin's definition relate and fit together; \cite{weber:operads-within} also explicates the connection with Leinster's presentation.

Here, we will use mostly the Batanin monoidal globular categories presentation, with occasional hints at the bigger picture of general monoidal pseudo-algebras, and a brief discussion of the connections with the use of Leinster's presentation in \cite{lumsdaine:tlca}.

The setting for each of these approaches is the 2-category $[\G^\op,\Cat]$ of \emph{globular categories}, or equivalently, of \emph{internal categories in globular sets}: $\intCat[[\G^\op,\Sets]]$.  From the latter description, we see that the strict $\omega$-category monad $T_\str$ on $[\G^\op,\Sets]$, being cartesian, gives a 2-monad $\Tcal_\str := \intCat[T_\str]$ on globular categories.

\begin{definition}[Weber, \protect{\cite[2.2; 6]{weber:operads-within}}]
A \emph{Weber monoidal globular category} is a normalised pseudo-algebra for $\Tcal_\str$.  Together with pseudo-homomorphisms and pseudo-2-cells, these form a 2-category $\PsAlg[0]{\Tcal_\str}$.
\end{definition}

\begin{definition}[Batanin] \cite[2.3]{batanin:natural-environment} More concretely, though less succinctly, a \emph{(Batanin) monoidal globular category} is a globular category 
$$\xymatrix{ \C_0 & \ar@<0.5ex>@{->>}[l]^s \ar@<-0.5ex>@{->>}[l]_t \C_1 & \ar@<0.5ex>@{->>}[l]^s \ar@<-0.5ex>@{->>}[l]_t \C_2 & \ar@<0.5ex>@{->>}[l]^s \ar@<-0.5ex>@{->>}[l]_t \cdots};$$
together with functors
$$ \tensor_k \colon \C_n \times_k \C_n \to \C_n, $$
$$ Z \colon \C_n \to \C_n+1 $$
satisfying source and target conditions analogous to those for composition and identities in a strict $\omega$-category, e.g.\ $s \cdot Z = 1 = t \cdot Z$, $s_i \cdot \tensor_k =  \tensor_k \cdot (s_i \times s_i)$ for $i > k$,  $s_i \cdot \tensor_k =  s_i \cdot \pi_2$ for $i \leq k$, etc;
natural isomorphisms analogous to the associativity and unitality axioms of a srtict $\omega$-category:
$$\alpha : R \tensor_k (S \tensor_k T) \iso (R \tensor_k S) \tensor_k T$$
$$\varepsilon_l : Z^{n-k}A \tensor_k R \iso R$$
$$\varepsilon_r : R \tensor Z^{n-k}A \iso R;$$
all satisfying various coherence axioms.

A pseudo-map of monoidal globular categories is\ldots

A pseudo-transformation between these is\ldots

Together, these form a 2-category $\MonGlobCat$.
\end{definition}

\begin{theorem}[\cite{weber:operads-within}] There is a 2-equivalence $\PsAlg{\Tcal_\str} \equiv_2 \MonGlobCat$.
\end{theorem}

This justifies our description of these definitions as, \emph{for 2-categorical purposes}, equivalent.  However, their underlying 1-categories (with non-identity 2-cells discarded) are not equivalent (CHECK CAREFULLY!), and it will not always be patently transparent that we deal only 2-categorically with them; so by ``monoidal globular category'', unmodified, we will always mean the Batanin version.

\subsection{Categories with fibrations: three variations on a theme}


We want to write: If $\C$ is a category with\ldots what?  ``a class of fibrations'' seems simplest, but in writing that down and refining the definition to be as principled as possible here, I just end up continuously deforming it into something much closer to a category with families.  Well\ldots let's go for the simplest and worry about making it more principled later.  Basically, the principled version should emphasise that being a fibration is extra structure, not a property\ldots or might not even be a structure: $\F$ needn't be an isofibration over $\C^\arr$.

OK: \emph{give} these three versions; show the continuous deformation!  It's interesting!

\begin{definition}(New version of the preceding.)  A category with \emph{right maps} is a category $C$ with a distinguished replete class $\R$ of maps (usually called \emph{right maps}\footnote{named by analogy with Right Whales} or \emph{fibrations}) such that:
\begin{enumerate}
\item considered as a subcategory of $\C^\Two$, $\R$ is closed under isomorphism;
\item $\R$ is closed under all pullbacks (i.e.\ chosen(?) pullbacks of right maps along all maps exist and are again right maps); and
\item $\R$ is closed under composition and contains identities.
\end{enumerate}

A \emph{class of left maps} is of a class of maps satisfying the dual axioms: closed under isomorphism, all pushouts, composition and identities and. 
\end{definition}

However, in practice one works with left or right maps as extra \emph{structure}, or ``\emph{co-structure}'', on maps of $\C$: for instance, cloven fibrations of categories, or Serre cofibrations presented as (retracts of) relative cell complexes.  This approach is systematically studied in the context of \emph{algebraic weak factorisation systems} (Tholen, Garner, et al (select citations!)); again, the definition we consider here is somewhat weaker.

\begin{definition}A category with \emph{structured right maps} is a category $\C$, together with a category $p \colon \F \to \C^\Two$, such that:
\begin{enumerate}
\item $p$ is a cloven isofibration;
\item $\cod \cdot p \colon \F \to \C$ is a cloven fibration, and $p$ sends cartesian arrows to pullback squares;
\item $p$ is a monoid with respect to the monoidal structure on $\Cat/\C^\Two$ given by $f \tensor g = (\dom \cdot f) \times_\C (\cod \cdot g)$, and the unit and multiplications structures are maps of cloven fibrations over $\C$.
\end{enumerate}

\emph{Structured right maps} are defined dually: $\cod \cdot p$ is a cloven opfibration, and $p$ sends co-cartesian arrows to pushout squares.
\end{definition}

These conditions are just algebraisations of those of the previous definition.  The monoidal structure tells us that for a composable pair of right maps $A \to^\fbf B \to^\gbf C$ (with underlying maps $A \to^f B \to^g C$), there is a right map $\gbf \cdot \fbf$, and so on.  That the structure maps preserves cleavings tell us that these compositions and identities are preserved by pullback: $k^* (\gbf \cdot \fbf) = (k^* \gbf) \cdot ((\gbf^*k)^* \fbf)$.

However, in practice again, the most natural presentation of (co)fibrations is sometimes not as structures on maps of $\C$, but as structures over objects of $\C$. 
In the case of Serre cofibrations, again, ``relative cell complexes over (check wording: `over'? `extending'?) a base space $B$'' are more fundamental objects, and often more convenient to work with, than ``maps out of $B$, with isomorphisms to the realisation of some cell complex''.  (This example isn't great, since definition of cell complex varies and with some it's \emph{always} only up to iso; maybe needs tweaked.)  Similarly, in our fundamental type-theoretic example, the map $\Gamma \to \Gamma,1$ (in a theory with strong unit types) is isomorphic to $1_\Gamma$ or $\Gamma,1 \to \Gamma$, but is not itself the dependent projection from any context extension; we may work with the \emph{context extensions} themselves, rather than with the class of ``maps isomorphic to some dependent projection''.

This also arises in the formalisation of mathematics in dependent type theories, and more generally in the formation of internal structures in model categories and similar environments\ldots  [explain more!]

To accommodate this, we simply drop the condition in the previous definition that $p$ should be an isofibration.  This brings us to the definition:

\begin{definition}
A \emph{something} on a category $\C$ is a functor $p: \F \to \C^\Two$, such that $\cod \cdot p$ is a cloven fibration, $p$ sends cartesian maps to pullback squares, and $p$ is equipped with a monoid structure in $(\Cat/\C,\tensor)$, whose structure maps preserve the cleavings.
\end{definition}

But we've seen this before!  This is simply a comprehension structure on $\C$ with strict sum and unit types, as defined in Section \ref{sec:comprehension} above, arrived at from a different direction.

Connecting these three, we have adjunctions over $\Cat$:

$$\CompCat_{\textrm{v-str-sum}} \two/->`<-/^F_U \Cat\mbox{-}\mathbf{StrRMaps} \two/->`<-/^F_U \Cat\mbox{-}\mathbf{ClsRMaps}$$

of which the second is a reflection, and the first might be (????) a $2$-equivalence.

 Then we can define a monoidal globular category $\FibSpans_\R(\C)$ (or just $\FibSpans(\C)$, when $\R$ is clear from context) as follows: \ldots  \todo{Do this!}

A globular object in $\FibSpans(\C)$ is then just a globular object $\X$ in $\C$, all of whose source and target maps are fibrations.

Given such a globular object $\X$, its ``diagram objects'' $X^\pi$ in $\FibSpans$ are computed by $X^\pi = \lim_{c \in \widehat{\pi}_n} X_n$.  More precisely, the diagram objects of $\X$ are themselves higher spans; these are the objects of $\C$ that appear in those spans \ldots  \todo{[Give pylon diagram!]}

(So if $\C$ has enough limits that the pointwise right Kan extension $\Ran_{\yon}(\X) : \GSets^\op \to \C$ exists, then these objects are computed by it: $X^\pi = \Ran_{\yon}(\X)(\pi)$.)

So elements of the endomorphism operad consist in \emph{pylon diagrams} as follows: [diagram].

\begin{example}
If $\C$ is any category with all pullbacks, then by taking the right maps to be all maps, we have the case $\FibSpans(\C) = \Spans[\C]$, as constructed in \cite{batanin:natural-environment}.
\end{example}

\begin{example}
The classifying category $\cl(\T)$ of a type theory, with the right maps as dependent projections.  This is of course our fundamental application!
\end{example}

\begin{example}
$\Top^\op$, with relative cell complexes.  Better, think of these as left maps in $\Top$; and think of $\CofCosps(\Top) := \FibSpans(\Top^\op)$.
\end{example}

\subsection{\ldots and with left and right maps}

(Adapted from Richard and Benno's analysis in \cite{garner-van-den-berg}.)

\begin{definition}A \emph{category with left and right maps} is a category $\C$, with a class $\R$ of right maps as above, and a class $\L$ of left maps, closed under pushout and composition and identities and weakly orthogonal to the right maps.  (Note: no factorisations asked for!) 

(Again, should make this more principled/algebraic: not classes of maps, but extra (co-)structure on maps, etc.)
\end{definition}

\begin{example} \label{ex:left-maps-from-right} A very well-known example: If $\C$ is any category with a class $\L$ of left maps, we can define right maps $\L^\pitchfork$ to be the class of maps weakly orthogonal to all maps in $\L$.  \cite{hovey-find-orthogonality}  Indeed, we may start with any class $\I$ of maps, without any axioms needed; $\I^\pitchfork$ will always satisfy the axioms for a class of right maps.

Algebraising this (\cite[3.8]{garner:understanding}), given any functor $U : \I \to \C^\Two$, we can define a class of structured right maps $\R = (\I,U)^\pitchfork$ by defining an $\R$-structure on $f$ to consist of a choice of diagonal filler for every square
$$\xymatrix{ \bullet \ar[r] \ar[d]_{Ui} & \bullet \ar[d]^f \\ \bullet \ar[r] & \bullet }.$$

Or, more coherently: equipped with \emph{coherent} such choices, equivalently with a filler for every \emph{triangle}, from which coherent choices are then determined via pullbacks.  Or, most relevantly at all: this, but starting just with triangles from a given \emph{generating set} or $\R$-maps.) [currently very cryptic, flesh it out!]
\end{example}

\begin{example}$\Top$, with relative cell complexes as left maps, and fibrations as right maps.
\end{example}

\begin{definition}For any other class of maps $\K$, a \emph{$\K$-absolute left (resp.\ right) map} in such a category is a map whose every pullback (pushout) along a $\K$-map is a left (right) map.  (NB: when $\K$ contains identities (it always will) this includes, of course, the map itself.)  When $\K$ is unspecified, ``absolute left map'' will generally mean $\R$-absolute, and vice-versa.

(Algebraically: \ldots with a chosen left- (right-)map structure on its every pullback (pushout)\ldots)  
\end{definition}

\begin{example}In a classifying category $\cl(\T)$, with left maps determined by right maps as described above, the elim- and comp-rules give a left-map structure on the intro context morphism for any single-intro-rule constructor; this left map is absolute if the elim-rule is given with a Frobenius condition.
\end{example}

Now, work in a category $\C$ with left and right maps.  Suppose $\X$ is a globular object in $\FibSpans$, i.e.\ a globular object in $\C$; and suppose $\X$ extends to a \emph{reflexive} globular object, whose reflexivity maps $r$ are all absolute left maps.

Then a whole bunch of maps between the objects $X^\pi$ are also left maps!  \ldots which ones??  Well\ldots any that realise maps of reflexive globular sets that can be built as composites of pushouts of $r$'s along composites of $s$'s and $t$'s.  In particular, any map $X^\rho \to X^\pi$ induced by an injection of Batanin trees $\tree(\pi) \to \tree(\rho)$ is a left map.

(This is very cryptic!  Give examples of what this means.)

\begin{example}
In $\cl(\T)$, for a theory with identity types, the tower of identity types is a globular object of this sort.  From this it is a short step (see \cite{lumsdaine:tlca-journal}, \cite{garner-van-den-berg}, and \ref{subsec:endo-contractible} below) to constructing the fundamental weak $\omega$-groupoid of a type.
\end{example}

(Note: $\Top$ doesn't seem to quite give an example of this setup$\ldots$ at least, I can't see what classes of left/right maps make the reflexivity maps \emph{absolute} right-maps.  e.g.\ They're absolute w.e.'s since they have triv-cof sections, but they're not absolute fibrations; the particular pushouts involved do end up still giving fibrations, but I can't see an abstract explanation for why.)

We can spin further variations on this principle.  In particular:

\begin{proposition}
Suppose $\C$ has left and right maps $\L \pitchfork \R$, and another class of left maps $\L' \supseteq \L$.  Suppose $\X$ is a globular object in $\CofCosps_{\L'}(\C)$, with reflexivity sections in dimension $\geq 1$ that are $\L'$-absolute $\R$-maps.  Then for any injection of Batanin trees $\tree(\pi) \to \tree(\rho)$ that is the identity in dimension $\leq 1$, the induced $X^\rho \to X^\pi$ is an $\R$-map.
\end{proposition}





































%% Bibliography Info

\bibliographystyle{amsalpha}
\bibliography{pll-thesis-bib}



\end{document}