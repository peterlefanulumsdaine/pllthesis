\documentclass{amsart}

\usepackage{ifpdf}
\usepackage{mathpartir}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{amsmath}
\usepackage[all]{xypic}
\xyoption{2cell}
\xyoption{rotate}
%\xyoption{curve}
\UseTwocells
\input{diagxy}

% \usepackage{makeindex}

\include{thesis-style}
\include{thesis-macros}

\newcommand{\CompCat}{\mathbf{CompCat}}

\newcommand{\arr}{\mathrm{arr}}
\newcommand{\ext}{\mathrm{ext}}
\newcommand{\Jbar}{\overline{J}}
\newcommand{\tr}{\mathrm{tree}}
\newcommand{\stuff}{{\Phi}}
% \makeindex

%%
%% PDFJUNK
%% Can add /CreationDate, /Creator, /Subject, /Keywords
%%
\ifpdf
\pdfinfo{
  /Author (Peter LeFanu Lumsdaine) 
  /Title (TODO: put thesis title here when decided!)
}
\fi
%%
%% BEGIN DOCUMENT:
%\onehalfspacing
\begin{document}



%% TITLE INFORMATION

\title{The classifying wea $\omega$-category of a type theory (informal draft)}

\author[P. LeF. Lumsdaine]{Peter LeFanu Lumsdaine}

\maketitle
\tableofcontents

\section*{General notes on these notes}

Note on notation: all fibrations of categories are assumed cloven, but considered just as fibrations ($\Fib$), maps between them need not preserve the cleavings, whereas maps of cloven fibrations ($\ClovFib$) do.

\section{Endomorphism operads; categories with fibrations} \label{sec:endo-operads}

\subsection{Background}

To open: Quickly recall (as in prev paper) strict $\omega$-categories.

To do here: Recall from \cite{batanin:natural-environment} Globular monoidal categories; operads.

In moving to the weak case, we wish to formalise the idea that our laws may hold only up to homotopy: there may be not just one way of composing a given pasting diagram, there may be several, although they will all be equal up to cells of the next dimension.

This is formalised in the notion of a \emph{contractible globular operad}.  There are several equivalent presentations of this idea, as given in e.g. \cite{batanin:natural-environment}, \cite{leinster:book}, and \cite{weber:operads-within}.

The presentation of Leinster (\cite{leinster:book}) (which I used in \cite{lumsdaine:tlca}), via cartesian monads and generalised multicategories, is perhaps the most accessible approach, but is less general than the others.  Some constructions may be extremely elegantly presented in this setting, but others become rather difficult.

The original presentation of Batanin (\cite{batanin:natural-environment}), via monoidal globular categories in general and $\Spans$ in particular, is more elementary, but with this approach it can be difficult sometimes to see the wood for the trees; constructions in this setting are typically long but comparatively straightforward to verify.  

The presentation of Weber (in e.g. \cite{weber:operads-within}), via \emph{monoidal pseudo-algebras} is, essentially, an abstraction of Batanin's approach, on the one hand allowing more generality, and on the other hand giving a clearer picture of how the various elements of Batanin's definition relate and fit together; \cite{weber:operads-within} also explicates the connection with Leinster's presentation.

Here, we will use mostly the Batanin monoidal globular categories presentation, with occasional hints at the bigger picture of general monoidal pseudo-algebras, and a brief discussion of the connections with the use of Leinster's presentation in \cite{lumsdaine:tlca}.

The setting for each of these approaches is the 2-category $[\G^\op,\Cat]$ of \emph{globular categories}, or equivalently, of \emph{internal categories in globular sets}: $\intCat[[\G^\op,\Sets]]$.  From the latter description, we see that the strict $\omega$-category monad $T_\str$ on $[\G^\op,\Sets]$, being cartesian, gives a 2-monad $\Tcal_\str := \intCat[T_\str]$ on globular categories.

\begin{definition}[Weber, \protect{\cite[2.2; 6]{weber:operads-within}}]
A \emph{Weber monoidal globular category} is a normalised pseudo-algebra for $\Tcal_\str$.  Together with pseudo-homomorphisms and pseudo-2-cells, these form a 2-category $\PsAlg[0]{\Tcal_\str}$.
\end{definition}

\begin{definition}[Batanin] \cite[2.3]{batanin:natural-environment} More concretely, though less succinctly, a \emph{(Batanin) monoidal globular category} is a globular category 
$$\xymatrix{ \C_0 & \ar@<0.5ex>@{->>}[l]^s \ar@<-0.5ex>@{->>}[l]_t \C_1 & \ar@<0.5ex>@{->>}[l]^s \ar@<-0.5ex>@{->>}[l]_t \C_2 & \ar@<0.5ex>@{->>}[l]^s \ar@<-0.5ex>@{->>}[l]_t \cdots};$$
together with functors
$$ \tensor_k \colon \C_n \times_k \C_n \to \C_n, $$
$$ Z \colon \C_n \to \C_n+1 $$
satisfying source and target conditions analogous to those for composition and identities in a strict $\omega$-category, e.g.\ $s \cdot Z = 1 = t \cdot Z$, $s_i \cdot \tensor_k =  \tensor_k \cdot (s_i \times s_i)$ for $i > k$,  $s_i \cdot \tensor_k =  s_i \cdot \pi_2$ for $i \leq k$, etc;
natural isomorphisms analogous to the associativity and unitality axioms of a srtict $\omega$-category:
$$\alpha : R \tensor_k (S \tensor_k T) \iso (R \tensor_k S) \tensor_k T$$
$$\epsilon_l : Z^{n-k}A \tensor_k R \iso R$$
$$\epsilon_r : R \tensor Z^{n-k}A \iso R;$$
all satisfying various coherence axioms.

A pseudo-map of monoidal globular categories is\ldots

A pseudo-transformation between these is\ldots

Together, these form a 2-category $\MonGlobCat$.
\end{definition}

\begin{theorem}[\cite{weber:operads-within}] There is a 2-equivalence $\PsAlg{\Tcal_\str} \equiv_2 \MonGlobCat$.
\end{theorem}

This justifies our description of these definitions as, \emph{for 2-categorical purposes}, equivalent.  However, their underlying 1-categories (with non-identity 2-cells discarded) are not equivalent (CHECK CAREFULLY!), and it will not always be patently transparent that we deal only 2-categorically with them; so by ``monoidal globular category'', unmodified, we will always mean the Batanin version.

\subsection{Categories with fibrations: three variations on a theme}


We want to write: If $\C$ is a category with\ldots what?  ``a class of fibrations'' seems simplest, but in writing that down and refining the definition to be as principled as possible here, I just end up continuously deforming it into something much closer to a category with families.  Well\ldots let's go for the simplest and worry about making it more principled later.  Basically, the principled version should emphasise that being a fibration is extra structure, not a property\ldots or might not even be a structure: $\F$ needn't be an isofibration over $\C^\arr$.

OK: \emph{give} these three versions; show the continuous deformation!  It's interesting!

\begin{definition}(New version of the preceding.)  A category with \emph{right maps} is a category $C$ with a distinguished replete class $\R$ of maps (usually called \emph{right maps}\footnote{named by analogy with Right Whales} or \emph{fibrations}) such that:
\begin{enumerate}
\item considered as a subcategory of $\C^\Two$, $\R$ is closed under isomorphism;
\item $\R$ is closed under all pullbacks (i.e.\ chosen(?) pullbacks of right maps along all maps exist and are again right maps); and
\item $\R$ is closed under composition and contains identities.
\end{enumerate}

A \emph{class of left maps} is of a class of maps satisfying the dual axioms: closed under isomorphism, all pushouts, composition and identities and. 
\end{definition}

However, in practice one works with left or right maps as extra \emph{structure}, or ``\emph{co-structure}'', on maps of $\C$: for instance, cloven fibrations of categories, or Serre cofibrations presented as (retracts of) relative cell complexes.  This approach is systematically studied in the context of \emph{algebraic weak factorisation systems} (Tholen, Garner, et al (select citations!)); again, the definition we consider here is somewhat weaker.

\begin{definition}A category with \emph{structured right maps} is a category $\C$, together with a category $p \colon \F \to \C^\Two$, such that:
\begin{enumerate}
\item $p$ is a cloven isofibration;
\item $\cod \cdot p \colon \F \to \C$ is a cloven fibration, and $p$ sends cartesian arrows to pullback squares;
\item $p$ is a monoid with respect to the monoidal structure on $\Cat/\C^\Two$ given by $f \tensor g = (\dom \cdot f) \times_\C (\cod \cdot g)$, and the unit and multiplications structures are maps of cloven fibrations over $\C$.
\end{enumerate}

\emph{Structured right maps} are defined dually: $\cod \cdot p$ is a cloven opfibration, and $p$ sends co-cartesian arrows to pushout squares.
\end{definition}

These conditions are just algebraisations of those of the previous definition.  The monoidal structure tells us that for a composable pair of right maps $A \to^\fbf B \to^\gbf C$ (with underlying maps $A \to^f B \to^g C$), there is a right map $\gbf \cdot \fbf$, and so on.  That the structure maps preserves cleavings tell us that these compositions and identities are preserved by pullback: $k^* (\gbf \cdot \fbf) = (k^* \gbf) \cdot ((\gbf^*k)^* \fbf)$.

However, in practice again, the most natural presentation of (co)fibrations is sometimes not as structures on maps of $\C$, but as structures over objects of $\C$. 
In the case of Serre cofibrations, again, ``relative cell complexes over (check wording: `over'? `extending'?) a base space $B$'' are more fundamental objects, and often more convenient to work with, than ``maps out of $B$, with isomorphisms to the realisation of some cell complex''.  (This example isn't great, since definition of cell complex varies and with some it's \emph{always} only up to iso; maybe needs tweaked.)  Similarly, in our fundamental type-theoretic example, the map $\Gamma \to \Gamma,1$ (in a theory with strong unit types) is isomorphic to $1_\Gamma$ or $\Gamma,1 \to \Gamma$, but is not itself the dependent projection from any context extension; we may work with the \emph{context extensions} themselves, rather than with the class of ``maps isomorphic to some dependent projection''.

This also arises in the formalisation of mathematics in dependent type theories, and more generally in the formation of internal structures in model categories and similar environments\ldots  [explain more!]

To accommodate this, we simply drop the condition in the previous definition that $p$ should be an isofibration.  This brings us to the definition:

\begin{definition}
A \emph{something} on a category $\C$ is a functor $p: \F \to \C^\Two$, such that $\cod \cdot p$ is a cloven fibration, $p$ sends cartesian maps to pullback squares, and $p$ is equipped with a monoid structure in $(\Cat/\C,\tensor)$, whose structure maps preserve the cleavings.
\end{definition}

But we've seen this before!  This is simply a comprehension structure on $\C$ with strict sum and unit types, as defined in Section \ref{sec:comprehension} above, arrived at from a different direction.

Connecting these three, we have adjunctions over $\Cat$:

$$\CompCat_{\textrm{v-str-sum}} \two/->`<-/^F_U \Cat-\mathbf{StrRMaps} \two/->`<-/^F_U \Cat-\mathbf{ClsRMaps}$$

of which the second is a reflection, and the first might be (????) a $2$-equivalence.

 Then we can define a monoidal globular category $\FibSpans_\R(\C)$ (or just $\FibSpans(\C)$, when $\R$ is clear from context) as follows: \ldots

A globular object in $\FibSpans(\C)$ is then just a globular object in $\C$, all of whose source and target maps are fibrations.

Given such a globular object $\X$, its ``diagram objects'' $X^\pi$ in $\FibSpans$ are computed by $X^\pi = \lim_{c \in \widehat{\pi}_n} X_n$.  (So if $\C$ has enough limits that the pointwise right Kan extension $\Ran_{\yon}(\X) : \GSets^\op \to \C$ exists, then these objects can be computed by it: $X^\pi = \Ran_{\yon}(\X)(\pi)$.)

So elements of the endomorphism operad consist in \emph{pylon diagrams} as follows: [diagram].

\begin{example}
If $\C$ is any category with all pullbacks, then by taking the right maps to be all maps, we have the case $\FibSpans(\C) = \Spans(\C)$, as constructed in \cite{batanin:natural-environment}.
\end{example}

\begin{example}
The classifying category $\cl(\T)$ of a type theory, with the right maps as dependent projections.  This is of course our fundamental application!
\end{example}

\begin{example}
$\Top^\op$, with relative cell complexes.  Better, think of these as left maps in $\Top$; and think of $\CofCosps(\Top) := \FibSpans(\Top^\op)$.
\end{example}

\subsection{\ldots and with left and right maps}

(Adapted from Richard and Benno's analysis in \cite{garner-van-den-berg}.)

\begin{definition}A \emph{category with left and right maps} is a category $\C$, with a class $\R$ of right maps as above, and a class $\L$ of left maps, closed under pushout and composition and identities and weakly orthogonal to the right maps.  (Note: no factorisations asked for!) 

(Again, should make this more principled/algebraic: not classes of maps, but extra (co-)structure on maps, etc.)
\end{definition}

\begin{example} \label{ex:left-maps-from-right} From any category with right maps, can take the left maps to be all maps weakly orthogonal to the right maps.  (Or, more algebraically: maps equipped with a choice of filler for every suitable square.  Or, more coherently: equipped with \emph{coherent} such choices, equivalently with a filler for every \emph{triangle}, from which coherent choices are then determined via pullbacks.  Or, most relevantly at all: this, but starting just with triangles from a given \emph{generating set} or $\R$-maps.) [currently very cryptic, flesh it out!]
\end{example}

\begin{example}$\Top$, with relative cell complexes as left maps, and fibrations as right maps.
\end{example}

\begin{definition}For any other class of maps $\K$, a \emph{$\K$-absolute left (resp.\ right) map} in such a category is a map whose every pullback (pushout) along a $\K$-map is a left (right) map.  (NB: when $\K$ contains identities (it always will) this includes, of course, the map itself.)  When $\K$ is unspecified, ``absolute left map'' will generally mean $\R$-absolute, and vice-versa.

(Algebraically: \ldots with a chosen left- (right-)map structure on its every pullback (pushout)\ldots)  
\end{definition}

\begin{example}In a classifying category $\cl(\T)$, with left maps determined by right maps as described above, the elim- and comp-rules give a left-map structure on the intro context morphism for any single-intro-rule constructor; this left map is absolute if the elim-rule is given with a Frobenius condition.
\end{example}

Now, work in a category $\C$ with left and right maps.  Suppose $\X$ is a globular object in $\FibSpans$, i.e.\ a globular object in $\C$; and suppose $\X$ extends to a \emph{reflexive} globular object, whose reflexivity maps $r$ are all absolute left maps.

Then a whole bunch of maps between the objects $X^\pi$ are also left maps!  \ldots which ones??  Well\ldots any that realise maps of reflexive globular sets that can be built as composites of pushouts of $r$'s along composites of $s$'s and $t$'s.  In particular, any map $X^\rho \to X^\pi$ induced by an injection of Batanin trees $\tr(\pi) \to \tr(\rho)$ is a left map.

(This is very cryptic!  Give examples of what this means.)

\begin{example}
In $\cl(\T)$, for a theory with identity types, the tower of identity types is a globular object of this sort.  From this it is a short step (see \cite{lumsdaine:tlca-journal}, \cite{garner-van-den-berg}, and \ref{subsec:endo-contractible} below) to constructing the fundamental weak $\omega$-groupoid of a type.
\end{example}

(Note: $\Top$ doesn't seem to quite give an example of this setup$\ldots$ at least, I can't see what classes of left/right maps make the reflexivity maps \emph{absolute} right-maps.  e.g.\ They're absolute w.e.'s since they have triv-cof sections, but they're not absolute fibrations; the particular pushouts involved do end up still giving fibrations, but I can't see an abstract explanation for why.)

We can spin further variations on this principle.  In particular:

\begin{proposition}
Suppose $\C$ has left and right maps $\L \pitchfork \R$, and another class of left maps $\L' \supseteq \L$.  Suppose $\X$ is a globular object in $\CofCosps_{\L'}(\C)$, with reflexivity sections in dimension $\geq 1$ that are $\L'$-absolute $\R$-maps.  Then for any injection of Batanin trees $\tr(\pi) \to \tr(\rho)$ that is the identity in dimension $\leq 1$, the induced $X^\rho \to X^\pi$ is an $\R$-map.
\end{proposition}











\section{Type theories and categories with families}

\subsection{Setting: a category of dependent algebraic type theories}

\begin{definition}A \emph{category with families}: $\C$, $\Ty$, comprehension$\ldots$  Variations: with $\diamond$; with $1$, with nothing, accessible, contextual.
\end{definition}

\begin{proposition}[\cite{hofmann:syntax-and-semantics}, \cite{pitts:categorical-logic}] \label{prop:cwf-equivalence} Equivalence: small contextual CwF's are \emph{equivalent} to type theories presented by a small set of purely algebraic axioms (i.e.\ dependent terms and types, and equality axioms between them), via adjunction.  Hence: universal property of CwF's presented by axioms (need this precisely stated to allow us to use normalisation results below).
\end{proposition}

This equivalence justifies working with \emph{presentation-agnostic} category of type theories $\Th$: we will construct and work with objects of $\Th$ (\emph{theories}) sometimes as syntactic presentations, sometimes as categories with families.  Given any construction either on syntactically presented theories or on contextual CwF's, we'll extend it without comment to $\Th$, and so forth.

\begin{definition}Given a CwF, define $\Cxt : \C^\op \to \Sets$, ``dependent contexts''.  We'll use this throughout.

Also define, for $A \in \Ty(\Gamma)$, a \emph{term of type $A$}: a section $a : \Gamma \to \Gamma.A$ of the dependent projection $\Gamma.A \to \Gamma$.
\end{definition}

This also extends to two interesting constructions:

Firstly, a monad on $\CwF$ over $\Cat$, sending $(\C,\Ty)$ to $(\C,\Cxt)$.  This can be seen as the monad for ``very strong, strictly associative $\Sigma$-types''.  This'll be useful to us crucially but briefly, in Corollary \ref{cor:types-to-contexts} at the very end (we'll need to know that it lifts to act on $\Id$-types too; see next section).

Secondly, a comonad on $\CwF_\diamond$, sending $\C$ to $\Cxt(\diamond)$, with a fairly evident induced families structure.  This is an idempotent comonad; indeed, its fixed-points are precisely the contextual categories, so it exhibits these as a coreflective subcategory of $\CwF_\diamond$.

Slicing!  Write + state the universal property of slices $\C \slice A$ carefully\ldots but wait for now, and see what precise statement we need to use later.

\subsection{Constructors}

Of course, we want categories not just of \emph{algebraic} dependent type theories, but of type theories with \emph{constructors}; in particular, $\Id$- and $\Pi$-types.  These too can be succinctly and profitably defined in terms of CwF's.  In particular:

\begin{definition} An \emph{elim-structure} $J$ on a map $i : \Gamma \to \Theta$ is a function assigning, to every type $C \in \Ty(\Theta)$ and every term $d : \Gamma \to \Gamma.i^*C$ of type $i^*C$ (equivelently, every map $\hat{d} : \Gamma \to \Theta.C$ over $\Theta$) a term $J_{C,d} : \Theta \to \Theta.C$ of type $C$

An \emph{absolute (Frobenius?) elim-structure} on $i : \Gamma \to \Theta$ is an elim-structure $J_\Delta$ on $i.\Delta$ for each $\Delta \in \Cxt(\Theta)$.
\end{definition}

(Compare the last refinement described in Example \ref{ex:left-maps-from-right} above, with the basic dependent projections $\Theta.A \to \Theta$ as the generating $\R$-maps (see next subsection).)

This axiomatises the structure provided by the elimination/computation rules for an inductive type with just a single introduction form $i$.  (It can be nicely generalised to deal with multiple introduction forms, but we will not need that.) In particular:

\begin{definition}
A \emph{CwF with $\Id$-types} is a CwF $\C$, together with:
\begin{itemize}
\item for each context $\Gamma \in \C$ and type $A \in \Ty(\Gamma)$, a type $\Id_A \in \Ty(\Gamma.A.A)$, and a morphism $r_A : \Gamma.A \to \Gamma.A.A.\Id_A$ over $\Delta_A : \Gamma.A \to \Gamma.A.A$ with an absolute elim-structure $J_A$,
\item all stable in $\Gamma$, in that for $f:\Gamma' \to \Gamma$ and $A \in \Ty(\Gamma)$, we have $(f.A.A)^*\Id_A = \Id_{f^*A} \in \Ty(\Gamma'.f^*A.f^*A)$, and so on.
\end{itemize}
\end{definition}

Write $\CwF^\Id$, $\CwF_\diamond^\Id$, etc.\ for the various categories of CwF's with $\Id$-types.  

\begin{proposition}[\cite{hofmann:syntax-and-semantics}, \cite{pitts:categorical-logic}] This structure really does correspond precisely to the $\Id$-type rules: the equivalence of Proposition \ref{prop:cwf-equivalence} lifts to an equivalence between $\CwF^\Id_\cxl$ and a category of syntactically presented theories with $\Id$-type rules plus algebraic axioms. 
\end{proposition}

Note that given $\Id$-types on a CwF $(\C,\Ty)$, we can extend this to give $\Id$-types on $(\C,\Cxt)$: see the ``identity contexts'' of \cite{streicher:habilitationsthesis} or \cite{gambino-garner}.  However, the monad this underlaid on $\CwF$ does \emph{not} lift to a monad on $\CwF^\Id$: the multiplication functor turns out not to preserve $\Id$-contexts strictly.  (This could presumably be accommodated by developing a theory of pseudo-maps of $\CwF^\Id$'s.)

Also: define $\Pi$-types, $\eta$-rules, and extensional equality on them. 

\subsection{Left and right maps in a CwF} \label{subsec:left-right-in-cwf}
The above presentation of $\Id$-types via elim-structures is based on ideas of Gambino and Garner (\cite{gambino-garner}) which will be very useful to us: that any CwF has an important class of left and right maps, which in the presence of $\Id$-types is moreover a wfs.

The right maps are just (maps isomorphic to) (compositions of basic) dependent projections.  The left maps are maps admitting an (or algebraically: with a chosen) elim-structure; following observations above, this gives exactly $\L = {}^\pitchfork \R$.  

(\cite{gambino-garner} moreover gives a direct type-theoretic characterisation of $\R$-maps, and uses $\Id$-types to construct $\L,\R$ factorisations, but we will not need these.)

\subsection{Miscellaneous facts}

Normalisation result: syntactically presented theories in $\CwF$ or $\CwF^\Id$ presented just by terms (no extra equality axioms) are strongly normalising.  (Add remark maybe about how theories admitting such a presentation should be something like the projective or cofibrant ones?)



















\section{Left and right maps in $\DTT$}

\para In the next section, we'll construct classifying weak $\omega$-categories for theories with $\Id$-types and $\Pi$-types (with $\eta$-rules and functional extensionality), and discuss how it might be possible to extend this to require only the $\Id$-types.

The construction of the classifying weak $\omega$-category of a theory is closely analogous to that of the fundamental weak $\omega$-groupoid of a space: it is obtained by homming out of a complex of representing objects (``globes''), and so it is enough to show that these representing objects form a co-(weak $\omega$-category), just as the topological globes ($D^0$, $D^1$, $D^2$) [diagram!] do in $\Top$.

To that end, we set up in this section various classes of left and right maps on $\CwF^{\stuff}_\diamond$, and
then apply the machinery of Section \ref{sec:endo-operads} to show that the endomorphism operad of the globes is contractible.

Among this, only one step (showing that certain maps are absolute right maps) seems to require the $\Pi$-types for its proof.  In particular, we isolate and conjecture a certain type-theoretical principle, $\Jbar$, which would suffice for the proof of this step, and which seems to be of independent interest.  In particular, we discuss equivalent natural statements of $\Jbar$ from several rather different points of view: as a conservativity statement for certain theory extensions; as a second-order form of the $\Id$-elim rule; and as a form of observational equality for $\Pi$-types. 


\para[Type and term extensions]

For the remainder of this section, fix some collection $\stuff$ of the constructors and rules of Subsetcion \ref{subsec:construtors}, and work in $\DTT_\stuff$.  (The main cases of interest in the sequel are where $\stuff$ is either $(\Id)$, $(\Id,\Pi,\eta)$, or $(\Id,\Pi,\eta,\ext)$.)

For $n \geq 0$, we define theories $\T_\stuff[\Gamma_{(n)}]$, $\T_\stuff [\Gamma_{(n)} \types A]$, and $\T_\stuff [\Gamma_{(n)} \types a : A]$ to be the free theories on, respectively, a context of length $n$; a dependent type, in context of length $n$; and a term in such a type.  Axiomatically, each may be  specified by some subset of the rules below: $\T_\stuff[\Gamma_{(n)}]$ by the rules $i$-$\cxtrule$, for $0 \leq i < n$; $\T_\stuff [\Gamma_{(n)} \types A]$, by these rules together with $n$-$\typerule$; and $\T_\stuff [\Gamma_{(n)} \types a : A]$ by all of the above, together with $n$-$\termrule$:
$$\inferrule*[right={$i$-$\cxtrule$}]{\Gamma \types a_0:A_0\ \ldots\ \Gamma \types a_{i-1}:A_{i-1}}{\Gamma \types A_i(a_0,\ldots,a_{i-1})\ \type} \qquad \inferrule*[right={$i$-$\typerule$}]{\Gamma \types a_0:A_0\ \ldots\ \Gamma \types a_{i-1}:A_{i-1}}{\Gamma \types A(a_0,\ldots,a_{i-1})\ \type}$$
$$\inferrule*[right={$i$-$\termrule$}]{\Gamma \types a_0:A_0\ \ldots\ \Gamma \types a_{i-1}:A_{i-1}}{\Gamma \types a(a_0,\ldots,a_{i-1}) : A_i(a_0,\ldots,a_{i-1})}$$

(Of course, this gives $\T[\Gamma_{(n-1)} \types A] \iso \T[\Gamma_{(n)}]$; we retain the distinction just for notational clarity.)

\begin{definition}
The \emph{universal type (resp.\ term) extensions} are the inclusion maps
$$ i^\ty_n \colon \T_\stuff [\Gamma_{(n)}] \mono \T_\stuff[\Gamma_{(n)} \types A],$$
$$ i^\tm_n \colon \T_\stuff [\Gamma_{(n)} \types A] \mono \T_\stuff[\Gamma_{(n)} \types a : A].$$

A \emph{basic term/type extension} is a pushout of one of the universal extensions.  A \emph{term/type/term-and-type extension} is any composite (possibly transfinite) of basic extensions.
\end{definition}

So in syntactic terms, a basic term extension is just any extension of a theory $\T$ by a new constructor $\x: A_1 \ldots A_{n-1}(\x^{< n-1})\ \types\ a(\x) : A_n(\x)$, where the $A_i$ are existing types of the theory.  Similarly, a basic type extension is an extension by a single algebraic term-forming axiom.  An arbitrary extension is any extension of theories formed by iteratively adding (possibly sets of) axioms of these forms.

The classes of term, type, and term-and-type extensions are all closed under composition, identities, and pushouts, so form classes of left maps in the sense of Section \ref{sec:endo-operads} above.  (They are not, however under retracts\ldots or at least, not obiously; are they actually?  Weak form of ``any sub-theory of a free theory is free\ldots''.)

\begin{definition}A \emph{term-contraction} (resp.\ \emph{type-contraction}, \emph{contraction}) on a map $F \colon \T \to \S$ is an operation assigning a filler to every square

$$\xymatrix{ \T_\stuff[\Gamma_{(n)} \types A\ \type] \ar@{ >->}[d]_{i^\tm_n} \ar[r] & \T \ar@{->>}[d]^F \\ \T_\stuff[\Gamma_{(n)} \types a: A] \ar[r] & \S }$$
with left-hand-side a universal type (term, term or type) extension.  A map admits such fillers if and only if it is weakly orthognal to all type (term, term-and-type) extensions, in which case it is called \emph{type-contractible} (\emph{term-contractible}, \emph{contractible}).  We will write $\R_\tm$, $\R_\ty$, $R_{\tm\ty}$ for the classes of contractible maps.
\end{definition}

Contractibility is familiar in type-theoretic terms as a form of conservativity.  Term-contractibility, for instance, states that whenever we have a type $\Gamma\ \types_\T\ A\ \type$ of $\T$ whose interpretation in $\S$ is inhabited by some term $F(\Gamma)\ \types_\S\ a:F(A)$, it is already inhabited in $\T$ by some term $\Gamma\ \types_\T\ \overline{a}:A$, which moreover is a \emph{lifting} of $a$, in that we can prove $F(\Gamma)\ \types_\S\ F(\overline{a}) = a : F(A)$ in $\S$.  Type-contractibility asserts the same sort of conservativity for types derivable in $\S$ over a context from $\T$.

Indeed, this syntactic formulation of type-contractibility has been considered previously by Hofmann as a conservativity principle: see the discussion of logical frameworks in \cite[\SEC 4]{hofmann:syntax-and-semantics}.

\para Note that while neither form of contractibility directly provides any kind of lifting for definitional equality judgements, in the presence of identity types one can obtain weak forms of such liftings just from term-contractibility.  If for instance $\Gamma\ \types_\T\ a,a': A$ and $F(\Gamma)\ \types_\S\ F(a) = F(a'):F(A)$, then term-contractibility lets us lift $r(a)$ to some term $\Gamma\ \types_\T\ \overline{r(a)} : \Id_A(a,a')$.  Essentially, definitional equality for terms implies propositional equality, and for types, isomorphism-up-to-prop.-eq.; and since these are matters of term-judgements, they can be lifted along a term-contractible map. 

Often, term-contractibility implies type-contractibility.  In particular, in many important theories, the type-forming axioms do not mention any of the specific term-constructors.  From this it follows that any type judgment factors uniquely as a type judgement derivable without any term-formers (the ``shape'' of the type), followed by substitution along some context morphism.  Now if $F \colon \T \to \S$ is a morphism between two theories with this property, and $\S$ has the same type-forming rules as $\T$, then if $F$ is term-contractible, it is also type-contractible.  [Give this in more detail??  We never actually need it later, but it's an interesting fact.]

\para Since the classes of contractible maps are defined by an orthogonality condition, they are easily seen to be closed under retracts, by the standard argument (see eg \cite[where?]{hovey}).  This can be seen by a brief diagram-chase:  
$$\xymatrix{ \bullet \ar[r] \ar@{ >->}[d]_i & \bullet \ar[r] \ar[d]^f & \bullet  \ar[r] \ar@{->>}[d]^g & \bullet \ar[d]^f \\ \bullet \ar[r] \ar@{.>}[urr] & \bullet \ar[r] & \bullet \ar[r] & \bullet }$$
If $f$ is a retract of $g$, $g$ is contractible, and we are given a square from $i$ to $f$ to fill, take this as the leftmost square above, and build out to the right.  By the lifting property of $g$, we can find a diagonal filler for the overall $3 \times 1$ rectangle; but thanks to the retraction, this rectangle is exactly the original square.  [This proof probably shouldn't be in the main body; omit it entirely, or relegate it to an appendix?]

Similarly, any transfinite composition of (term-, type-) contractible maps is again contractible.

\begin{example} \label{ex:elim-gives-contraction}
For any context morphism $f : \Delta \to \Theta$, the induced map of slices $f^*\colon \T \slice \Theta \to \T \slice \Delta$ is orthogonal to $i^\tm_0$ just if $f$ is orthogonal to all dependent projections---that is, if $f$ is a left map in the sense of Gambino--Garner \cite{gambino-garner}---or equivalently, if $f$ admits an ``elimination rule'':
$$\inferrule{\y : \Theta \types C(\y)\ \type \\ \z:\Delta \types d(\z): C(f(\z))}{\x : \Theta\ \types\ \mathsf{elim}_f(\y.C, \z.d; \x) : C(\x)}$$
(and associated computation rule).

[diagram!]

Moreover, $f^*$ is term-contractible exactly if every pullback of $f$ along a dependent projection is a Gambino--Garner left map, or equivalently if it supports a ``Frobenius'' form of this elimination rule, with extra dependent premises in the context, i.e.\ 
$$\y : \Theta, w: \Xi(\y) \types C(\y,\w)\ \type \ldots$$

Moreover, this is implied by $f$ alone being a left map as long as $\T$ has identity types (by \cite[5.2.1]{gambino-garner}), or $\Pi$-types (by standard arguments).

In particular, for every reflexivity map $\r \colon \Delta.B \to \Delta.B.B.\Id_B$, the map $r^*$ between slices is term-contractible.  TODO: and for the variant $\Id$-elim.
\end{example}

\begin{example}
As remarked above, if $\T$ is any theory and $\T^\mathrm{LF}$ is its presentation in a logical framework, then according to \cite[\SEC 4]{hofmann:syntax-and-semantics}, the interpretation of $\T$ in $\T^\mathrm{LF}$ is type-contractible. 
\end{example}

\para Since $\DTT$ is the category of models of an algebraic theory, and so is locally presentable, we can use the machinery of \cite{garner:understanding} (the ``algebraic small-object argument'') to construct an algebraic weak factorisation system\footnote{aka natural weak factorisation system} on $\DTT$, using the universal extensions (term, type, or both) as the generating left maps.  The algebraic right maps in the resulting system are then just maps equipped with (term-, type-) contractions; the algebraic left maps are maps presented as (term, type, term-and-type) extensions.

We can think of the maps $i^\ty_n$, $i^\tm_n$ here as \emph{generating cofibrations} in a putative model structure on $\DTT$, and the contractible maps as the \emph{trivial fibrations}; this idea is taken a little further in Section \ref{sec:model-strux} below.

By example \ref{ex:elim-gives-contraction}, this factorisation system on $\DTT$ is in some sense dual to the Gambino--Garner systems on the classifying categories of individual theories.  We will make this idea more precise in Section \ref{sec:fam-strux-on-DTT}.






\section{Extensions by propositional copies: the conservativity principle $\Jbar$.}

On of the fundamental lemmas for many logical systems is that \emph{extension by definitions} should be well behaved: that if we extend a theory $\T$ by adding a new term $a'$, and an axiom that $a'$ is equal to some pre-existing term $a$ of $\T$, then the resulting theory is in some sense equivalent to $\T$.

For dependent type theories, this is clear when the new constructor is posited to be \emph{definitionally} equal to an existing one: the resulting theory $\T[a := a']$ is isomorphic to $\T$ itself.

However, one may also wish to understand a weaker situation, where the new term is only posited to be \emph{propositionally} equal to the existing one; precisely, where we extend $\T$ by axioms
$$\inferrule{\ }{\x : \Gamma \types a'(\x) : A(\x)} \qquad \inferrule{\ }{\Gamma \types l(\x) : \Id_A(a'(\x),a(\x)) }$$
Briefly, denote the resulting theory by $\T[a'(\x) :\propeq(\x) a]$, or when more detail is needed, by $\T[\x: \Gamma\ \types\ a'(\x) :\propeq_{l(\x)} a(\x) : A(\x)]$ or similar.

Categorically, extensions of this form are precisely pushouts of the universal ones 
$$\T_\stuff[\Gamma_{(n)} \types a: A] \mono \T_\stuff[\Gamma_{(n)} \types a: A][a'(\x) :\propeq a(\x)].$$
We will call (possibly transfinite) compositions of such pushouts \emph{extensions by propositional copies}, and write them as $\T[a_i'(\x) :\propeq a_i](\x)$

What can we now say about the inclusion $\T \mono \T[a'(\x) :\propeq a(\x)]$?  It is certainly not an isomorphism in general, nor indeed contractible, since $a'$ will rarely be in its image.  On the other hand, it is by definition a term-extension.  It is also certainly a monomorphism, since it has a retraction $\T[a'(\x) :\propeq a(\x)] \epi \T$, given by interpreting $a'$ as $a$ and $l$ as $r(a)$.

Our principle $\Jbar$ describes one sense in which $\T[a'(\x) :\propeq a(\x)]$ may reasonably be equivalent to $\T$:

\begin{definition}Say that \emph{$\Jbar$ holds for $\stuff$} if for every extension by propositional copies, the retraction $\T[a'(\x) :\propeq a(\x)] \epi \T$ is term-contractible.

In other words, the universal such extensions
$$\T_\stuff[\Gamma_{(n)} \types a: A] \mono \T_\stuff[\Gamma_{(n)} \types a: A][a'(\x) :\propeq a(\x)].$$
are absolutely term-contractible.
\end{definition}

(Actually, this is stronger than we will need: for present purposes, e.g.\ ``$\L_{\tm\ty}$-absolutely'' would be quite enough, i.e.\ that $\Jbar$ holds for extensions of cofibrant theories.)

If we consider adjoining only copies of \emph{closed} terms, i.e.\ in the case where $\Gamma = \diamond$, then note that the extension and its retraction are isomorphic to the maps of slices
$$\xymatrix{ \T \ar@{ >->}@/^/[r] \ar@{=}[d] & \T[a' :\propeq a] \ar@{->>}@/^/[l] \ar@{<=>}[d]|\iso \\
\T \slice \diamond \ar@{ >->}@/^/[r] & \T \slice (x:A, u:\Id(x,a)) \ar@{->>}@/^/[l] }
$$
induced by the retraction of contexts [TODO: yowch, fix horrible diagrams!]
$$\xymatrix{ \diamond \ar@{ >->}@/_/[r]_{a,r(a)} & (x:A, u:\Id(x,a)) \ar@{->>}@/_/[l]^{!}}.$$

But the map $(a,r(a)) \colon \diamond \mono x:A, i:\Id(x,a)$ is essentially an introduction map, so by Example \ref{ex:elim-gives-contraction}, the retraction  of slices $(a,r(a))^*$ is certainly term-contractible.

Thus $\Jbar$---like various other type-theoretic principles [TODO: which!?  I'm sure I had some good analogues in some point, but can't remember 'em now!]--- asserts that something which is holds easily for \emph{closed} terms holds also for \emph{open} terms.

One way to prove $\Jbar$ is therefore to reduce the general case to the closed case.  This is possible, as long as we assume $\Pi$-types, together with rules to make sure that their identity types are well-behaved:

\begin{proposition} \label{prop:jbar-holds}
$\Jbar$ holds for $(\Id,\Pi,\ext)$, and any set of constructors extending this.
\end{proposition}

\begin{proof}
The diagram
$$\xymatrix{\T[k(\x):K(\x)] \ar[d] \ar@/_/[r] & \ar@/_/[l] \T[\hat{k}:\Pi_{\x} K(\x) \ar[d] \\ 
\T[k_0(\x),k_1(\x):K(\x),\ l(\x):\Id(k_0(\x),k_1(\x))] \ar@/_/[r] & \ar@/_/[l] \T[\hat{k}_0,\hat{k}_1 : \Pi_{\x} K(\x),\ \hat{l}:\Id(\hat{k}_0,\hat{k}_1)]}$$
exhibits its left-hand side (the map we wish to show contractible) as a retract of its right-hand side.  (The fact that the squares commutes and are a retraction requires the ``ext'' axiom to satisfy some reasonable computation rule.)  But the right-hand side is just the closed case of $\Jbar$, which we've seen is contractible.
\end{proof}

\begin{proposition} \label{prop:jbar-fails}
$\Jbar$ fails for $(\Id,\Pi,\eta)$ and $(\Id,\Pi)$. 
\end{proposition}

\begin{proof}
Any failure of ``ext'' gives a failure of $\Jbar$.
\end{proof}

\begin{conjecture}
$\Jbar$ holds for $(\Id)$.
\end{conjecture}

Proposition \ref{prop:jbar-fails} shows that it's not stable under extensions of the constructor sets, so can't hold for $(\Id)$ in such a robust, algebraic way as it goes for $(\Id,\Pi,\ext)$.

Maybe mention the analogous ``$\overline{K}$'' principle, and how it fails when UIP does?

Waffle a bit about how to look at $\Jbar$, why even \footnote{(non-homotopically-inclined)}type theorists should care, etc\ldots



























\section{The type-theoretic globes, and the classifying whosemithingummy of a whatchamecallit}

\para Once again, fix some set $\stuff$ of constructors, including at least the $\Id$-rules.  The \emph{type-theoretic globes} (over $\stuff$) are then a sequence of theories $\globe[n]$ which play a similar r\^o{}le in $\DTT_\stuff$ to that which the discs $D^n$ play in $\Top$: they are an internal weak-$\omega$-cocategory, and as such will---almost---be representing objects for the classifying weak $\omega$-category functor.

\begin{definition} $\globe[n]$ is the theory generated by axioms $i$-$\sourcerule$, $i$-$\targetrule$ (for $0 \leq i < n$), and $n$-$\cellrule$, as follows:
$$
\inferrule*[right={0-$\sourcerule$}]{\ }{\diamond \types S_0\ \type} \qquad 
\inferrule*[right={0-$\targetrule$}]{\ }{\diamond \types T_0\ \type} \qquad 
\inferrule*[right={0-$\cellrule$}]{\ }{\diamond \types C_0\ \type}
$$
$$ 
\inferrule*[right={1-$\sourcerule$}]{\Gamma \types a : S_0}{\Gamma \types s_1(a): T_0} \qquad
\inferrule*[right={1-$\targetrule$}]{\Gamma \types a : S_0}{\Gamma \types t_1(a): T_0} \qquad
\inferrule*[right={1-$\cellrule$}]{\Gamma \types a : S_0}{\Gamma \types c_1(a): T_0} 
$$
$$
\inferrule*[right={$i$-$\sourcerule$}]{\Gamma \types a : S_0}{\Gamma \types s_i(a):\Id(s_{i-1}(a),t_{i-1}(a))} \qquad
$$
and $i$-$\targetrule$ , $i$-$\cellrule$\ exactly as $i$-$\sourcerule${} except with term-formers $t_i$, $c_i$ in place of $s_i$.
\end{definition}

\para There are evident interpretations between these theories, forming a reflexive coglobular object $\globes$ in $\DTT_\stuff$:

$$ \globe[0]\, \three/->`<-`->/<500>\ \globe[1]\, \three/->`<-`->/<500>\ \globe[2]\, \three/->`<-`->/<500> \ \ldots $$

Forgetting for now about the reflexivity, we can see the globes as a functor
$$ \globes \colon \GSets \to \DTT_\stuff .$$
Since $\DTT_\stuff$ is co-complete, this induces by general nonsense(\cite{find-citation-for-Kan-situation}) an adjoint pair of functors between $\GSets$ and $\DTT_\stuff$ (a ``Kan situation'').  Both these functors will be of central interest to us in the sequel:
$$\quad \xymatrix{ \GSets \ar@/_/[rrr]_{\T_\stuff [-]\, :=\, \Lan_\yon \globes \qquad \ \, } \ar@{}[rrr]|\top & & & \DTT_\stuff \ar@/_/[lll]_{\cl^-_\omega\ :=\ \DTT_\stuff(\globes,-)} \\ \G \ar@{ >->}[u]^\yon \ar@/_/[urrr]_{\globes} }
$$

The right adjoint, $\cl^-_\omega \colon \DTT_\stuff\ \to\ \GSets$, is defined by homming out of the globes, i.e.\ by setting $\cl^-_\omega(\T)_n = \DTT_\stuff(\globe[n],\T)$.  Thus, by the definitions of the globes, the 0-cells of $\cl^-_\omega(\T)$ correspond exactly to closed types in $\T$; the 1-cells $A \to B$ to terms of $A$ dependent on a single variable from $B$; the 2-cells to terms of type $\Id_B$ between 1-cells; and so on.

This is very nearly, but not quite, what we want for the underlying globular set of $\cl_\omega(\T)$.  The shortfall is that we have only the \emph{types} of $\T$ as 0-cells, not more general contexts; however, we will proceed for now with $\cl^-_\omega$, and remedy this deficiency later.

Meanwhile, the left adjoint $\T_\stuff [-] \colon \GSets\ \to\ \DTT_\stuff$ is constructed as the left Kan extension of $\globes$ along $\yon$, and may be seen as freely adjoining a globular set to $\T_\stuff$, using the globes as templates.  Explicitly, for a globular set $\X$, the theory $\T[\X]$ has axioms for each cell of $\X$, realising the 0-cells as closed types, the 1-cells as terms between these types, and the higher-cells as terms of appropriate identity types.\footnote{A related construction is considered in \cite{awodey-hofstra-warren} and \cite{hofstra-warren}, corresponding to a slightly different co-globular theory: they omit our $\globe[0]$, giving instead just a single closed base type, and realise $0$-cells as closed terms of this type, $1$-cells as terms of identity type between these, and so forth.  Their $T_\mathbf{ML}$ is then the monad induced by the Kan adjunction.}

 In particular, $\T_\stuff[\yon(n)] = \globe[n]$.  Also useful will by the boundary of the  $n$-globe, $\del \globe[n] := \T_\stuff[\del \yon(n)]$; up to isomorphism, this is the theory given by $i$-$\sourcerule$ and $i$-$\targetrule$, for $0 \leq i < n$, i.e.\ all the axioms of $\globe[n]$ except for $n$-$\cellrule$ itself.
 
\para Since $\DTT_\stuff$ is co-complete, we can consider (by Section \ref{sec:endo-operad}) the co-endomorphism operad of the globes, $\End_{\Spans(\DTT_\stuff^\op)}(\globes)$, or briefly just $\End(\globes)$.  We know that its operations of some shape $\pi$ are given by
$$\End(\globes)(\pi) \iso [\G/n,\DTT_\stuff](\globes \cotensor \hat{\pi},globes \cotensor \yon(n))$$
and hence, unwinding this formula, consist of pylon diagrams:

\begin{center}[TODO: BIG PYLON DIAGRAM!  OH, THE HUGE MANATEE!]\end{center}

\begin{proposition}If $\Jbar$ and the normalisation results of Proposition \ref{prop:normalisation} hold for $\stuff$, then $\End(\globes)$ is contractible.
\end{proposition}

\begin{proof}
As seen in section \ref{sec:endo-operads}, contractibility for this operad demands that given $\pi \in T1(n)$, and $(S_0,T_0,\ldots T_{n-1})$ as above, we must construct $R$ to complete the span; that is, we must complete the triangle
$$\xymatrix{ \del \globe[n] \ar[r]^{[S_i,T_i]} \ar@{ >->}[d] & \T_\stuff[\hat{\pi}] \\ \globe[n] \ar@{.>}[ur] & }.$$

In the case $n = 0$, the only pasting diagram consists of a single 0-cell, and $\del \yon (n)$ is empty, so we can trivially fill with the identity map:
$$\xymatrix{ \del \T_\stuff \ar[r]^{!} \ar@{ >->}[d]_{!} & \globe[0] \\ \globe[0] \ar@{.>}[ur] & }.$$

When $n > 0$, it is immediate from the axiomatisations given that the map $\del \globe[n] \to/ >->/ \globe[n]$ is a term-extension.

On the other hand, according to the pruning procedure described \ref{para:pruning} above, we can obtain $\T_\stuff[\hat{\pi}]$ as an extension of $\T_\stuff[\widehat{s_1\pi}]$ by propositional copies; so \emph{as long as $\Jbar$ holds for $\DTT_\stuff$}, the retraction
$$\T_\stuff[\hat{\pi}] \epi \T_\stuff[\widehat{s_1\pi}]$$
(interpreting all identity cells as reflexivity terms) is term-contractible.

Thus to complete the triangle above, it is sufficient to complete the square
$$\xymatrix{ \del \globe[n] \ar[r]^{[S_i,T_i]} \ar@{ >->}[d] & \T_\stuff[\hat{\pi}] \ar@{->>}[d] \\ \globe[n] \ar@{.>}[r] & \T_\stuff[\widehat{s_1\pi}]},$$
i.e.\ to complete a triangle of the form
$$\xymatrix{ \del \globe[n] \ar[dr] \ar@{ >->}[d] & \\ \globe[n] \ar@{.>}[r] & \T_\stuff[\widehat{s_1\pi}]}.$$

Now $s_1\pi$ is just a 1-dimenstional pasting diagram, i.e.\ a path $(\cdot \to<200> \cdot \to<200> \ldots \to<200> \cdot)$ of some length $l \geq 0$, so $\T_\stuff[\widehat{s_1\pi}]$ admits a very simple axiomatisation:

$$
\inferrule{\ }{\diamond \types A_i\ \type} \quad (0 \leq i \leq l) \qquad 
\inferrule{\ }{\Gamma \types a:A_{j-1} \types f_j(a) : A_j } \quad (1 \leq j \leq l) 
$$

This allows us to complete the job.  If $n = 1$, then the commutativity of the pylon diagram tells us that $\del \globe[1] \to \T_\stuff[\widehat{s_1\pi}]$ picks out the types $X_0$, $X_l$ as the interpretations of $S_0$, $T_0$, and so we interpret $c_1(x)$ by the obvious term $f_l(\ldots f_2(f_1(x))\ldots)$.

On the other hand, for $n \geq 2$, we have interpreted $i$-$\sourcerule$ and $i$-$\targetrule$ in $\T_\stuff[\widehat{s_1\pi}]$, for $i < n$, and wish to interpret $n$-$\cellrule$; i.e.\ we wish to prove a propositional equality between the interpretations of $s_{n-1}(x)$ and $t_{n-1}(x)$.   But the normalisation results of Section \ref{sec:normalisation} apply, and in particular, Corollary \ref{cor:normalisation-all-ids-are-refls} tells us that any two terms of the same type in $\T_\stuff[\widehat{s_1\pi}]$ are \emph{definitionally} equal; so interpreting $c_n$ by a reflexivity term, we are done.
\end{proof}

\subsection{Classifying weak $\omega$-categories}
% TODO: should be \\\texorpdfstring here

Even when $\End(\globes)$ is not contractible, it still acts naturally on $\cl^-_{\omega}$, by Lemma \ref{lemma:homming-out-of-P-alg}.  When it is contractible, the resulting map $L \to \End(\globes)$ allows us to pull this back to an action of $L$.  In particular, this allows us to lift $\cl^-_\omega$ to a functor into $\Alg{L} = \wkwCat$, which by abuse of notation we still denote $\cl^-_\omega$:
[diagram]

(Maybe show here and/or above that there's a map of operads $P_\Cat \to \End(\globes)$, and that $\globe[0]$, $\globe[1]$ represent via this the ordinary category of types??)

As mentioned before, this is not quite what we want; $\cl^-_\omega(\T)$ only has types as objects, where we would like contexts.  As a first attempt to remedy the situation, we can compose with the ``dependent contexts'' endofunctor $(-)^\cxt$ on $\DTT_\stuff$, and define $\cl^+(\T) := \cl^-_\omega(\T^\cxt)$.  


This is still not exactly what we initially described, since by the description of $(-)^\cxt$ in \ref{para:endofunctor-cxt}, there are now \emph{too many} objects, since we have not only contexts but formal decompositions of contexts. However, on the one hand, every object is isomorphic (in $\cl(\T^\cxt)$ and hence in $\cl^+_\omega(\T)$) to one of the ones we want, so if we had a good theory of equivalence of weak $\omega$-categories, $\cl^+_\omega(\T)$ should be \emph{equivalent} to what we want; and for now, lacking such a theory, we can reach the Goldilocks spot by simply throwing away the unwanted copies, defining $\cl_\omega(\T)$ to be the full (in all dimensions $> 0$) subcategory of $\cl^+_\omega(\T)$ on the un-subdivided contexts.  (We retain functoriality since this is a natural subobject of $\cl^+_\omega(\T)_0$.)  [note: could we do this more elegantly by moving earlier to non-contextual CwF's?]  We thus have:

\begin{theorem}If $\stuff$ is any set of rules for which $\Jbar$ and Corollary \ref{cor:normalisation} hold, then for any $\stuff$-theory $\T$, the globular set $\cl_\omega(\T)$ described in the introduction has a natural weak $\omega$-category structure; that is, we have a functor
$$\cl_\omega \colon \DTT \to \wkwCat.$$

In particular, this construction works when $\stuff$ is the rules for $\Id$-types, $\Pi$-types, and functional extensionality.
\end{theorem}

\subsection{A variant for non-extensional $\Pi$-types}

As noted above, $\Jbar$ (and hence this proof) fail in the category of theories with non-extensional $\Pi$-types.  Altering the globes a little lets us make things work there, so givs a little more generality for the classifying weak $\omega$-category.  On the other hand, this generality would come \emph{better} via our conjecture of $\Jbar$ for $(\Id)$\ldots

\subsection{CwF structures on $\CwF_\diamond^\op$ etc.}

An alternate perspective on $\Jbar$, shows that it can be seen not just as analogous to the $\Id$-elim rule, but actually as instance of it for a certain families-structure:

There are various important CwF-structures on categories of CwF's. In particular: there is a canonical CwF structure on $\CwF_\diamond^\op$, given by $\Ty^\mathrm{canon}_{\CwF_\diamond^\op}(\C) := \Ty_\C(\diamond)$, and $\C.A := \C/\!/A$.  The universal properties of slices (Proposition \ref{prop:slicing}), with general facts about free constructions, ensure that the requisite squares [diagram] are pullbacks.  (This is in some sense a universal CwF: certainly every small CwF may be obtained by pullback from it, a more precise statement can probably be formulated.)

This extends to a canonical CwF-structure with $\Id$-types on $(\CwF^\Id_\diamond)^\op$, a CwF-structure with $\Id$- and $\Pi$-types with $\eta$-rule on $(\CwF^{\Id,\Pi,\eta}_\diamond)^\op$, and so on.

However, we can bump up these structures a little further, to include certain ``formal $\Pi$-types'' (independently of what $\Pi$-types may already be present in the theories).  That is, we define $\Ty^\mathrm{canon + Pi}(\C) := \sum_{\Gamma \in \C} \Ty_\C(\Gamma)$; so a type over $\C$, in this families structure, is a type $A$ in some context $\Gamma$ of $\C$, to be thought of as the formal dependent product $\prod_\Gamma A$.

Context extension is by adjoining \emph{open} terms.

$\Jbar$ asserts that \emph{open} $\Id$-types in contexts are indeed $\Id$-types in this families structure.  (But danger, Will Robinson, danger: $\Jbar$ doesn't assert, and afaics doesn't imply, the stability/coherence conditions required for ``this families structure has $\Id$-types''.)

%% Bibliography Info

\bibliographystyle{amsalpha}
\bibliography{pll-thesis-bib}



\end{document}